<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>👤 Profile • EANO</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
</head>
<body>

  <div class="nav-fixed">
    <h1>👤 My Profile</h1>
    <button onclick="logout()" class="btn btn-danger">Logout</button>
  </div>

  <div class="feature-card">
    <h2 id="username">Loading...</h2>
    <p id="email">Checking email...</p>

    <p><strong>Balance:</strong> <span id="balance">0.000</span> EANO</p>
    <p><strong>Score:</strong> <span id="score">0</span></p>
    <p><strong>Trust Score:</strong> <span id="trust">0</span></p>

    <p><strong>Score Level:</strong> <span id="score-level">-</span></p>
    <p><strong>Mining Level:</strong> <span id="mining-level">-</span></p>

    <div id="badges" style="margin-top: 1rem; font-size: 1.5rem;"></div>
  </div>

  <div class="footer">
    &copy; 2025 EANO Network • Powered by Trust & Scores
  </div>

  <!-- Firebase + JS -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCzNpblYEjxZvOtuwao3JakP-FaZAT-Upw",
      authDomain: "eano-miner.firebaseapp.com",
      projectId: "eano-miner",
      storageBucket: "eano-miner.appspot.com",
      messagingSenderId: "50186911438",
      appId: "1:50186911438:web:85410fccc7c5933d761a9f"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const trustBadge = (score) => {
      if (score >= 5000) return "💠 O.G";
      if (score >= 1000) return "🟢 Trusted Miner";
      if (score >= 500)  return "🟡 Reliable Miner";
      if (score >= 300)  return "🔵 New Miner";
      return "🔴 Low Trust";
    };

    const miningLevel = (balance) => {
      if (balance >= 10000) return "🐉 Dragon";
      if (balance >= 5000) return "🐘 Elephant";
      if (balance >= 2500) return "🦍 Gorilla";
      if (balance >= 1200) return "🐻 Bear";
      if (balance >= 600)  return "🐯 Lion";
      if (balance >= 300)  return "🐼 Panda";
      if (balance >= 150)  return "🐺 Wolf";
      if (balance >= 50)   return "🐹 Hamster";
      return "🐥 Chicken";
    };

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        document.getElementById("username").textContent = user.displayName || "Unnamed Miner";
        document.getElementById("email").textContent = user.email || "No email";

        const ref = doc(db, "users", user.uid);
        const snap = await getDoc(ref);

        if (snap.exists()) {
          const data = snap.data();

          const balance = data.balance || 0;
          const score = data.score || 0;
          const trust = data.trustScore || 0;

          document.getElementById("balance").textContent = balance.toFixed(3);
          document.getElementById("score").textContent = score;
          document.getElementById("trust").textContent = trust;

          document.getElementById("score-level").textContent = trustBadge(score);
          document.getElementById("mining-level").textContent = miningLevel(balance);

          document.getElementById("badges").innerHTML = `
            ${trustBadge(score)} | ${miningLevel(balance)}
          `;
        }
      } else {
        window.location.href = "index.html";
      }
    });

    function logout() {
      signOut(auth).then(() => {
        window.location.href = "index.html";
      });
    }
  </script>

</body>
</html>
